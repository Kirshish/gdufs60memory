<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æå–è®°å¿† - è®°å¿†äº¤æ¢è®¡åˆ’</title>
  <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@3.15.0/dist/av-min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .header {
      text-align: center;
      color: white;
      margin-bottom: 40px;
      padding-top: 20px;
    }
    
    .header h1 {
      font-size: 36px;
      margin-bottom: 10px;
      letter-spacing: 1px;
    }
    
    .header p {
      font-size: 16px;
      opacity: 0.9;
      letter-spacing: 0.5px;
    }
    
    .container {
      max-width: 600px;
      margin: 0 auto;
    }
    
    .fishing-area {
      background: rgba(255,255,255,0.95);
      border-radius: 20px;
      padding: 40px;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      margin-bottom: 30px;
    }
    
    .fishing-icon {
      font-size: 80px;
      margin-bottom: 20px;
      animation: fishing 2s ease-in-out infinite;
    }
    
    @keyframes fishing {
      0%, 100% {
        transform: rotate(-10deg);
      }
      50% {
        transform: rotate(10deg);
      }
    }
    
    .fishing-text {
      font-size: 20px;
      color: #333;
      margin-bottom: 30px;
      letter-spacing: 0.5px;
    }
    
    .fishing-btn {
      padding: 18px 50px;
      font-size: 20px;
      font-weight: 600;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
      letter-spacing: 1px;
    }
    
    .fishing-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 40px rgba(102, 126, 234, 0.5);
    }
    
    .fishing-btn:active {
      transform: scale(0.98);
    }
    
    .fishing-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }
    
    .memory-card {
      display: none;
      margin-bottom: 30px;
      animation: cardAppear 0.5s ease-out;
    }
    
    .memory-card.show {
      display: block;
    }
    
    @keyframes cardAppear {
      from {
        opacity: 0;
        transform: scale(0.8) translateY(30px);
      }
      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }
    
    /* å¡ç‰‡æ ·å¼ - å’Œ card.html ä¿æŒä¸€è‡´ */
    #memoryCard {
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    
    .card-header {
      padding: 30px;
      text-align: center;
      color: white;
      background: rgba(0,0,0,0.1);
    }
    
    .card-title {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 5px;
      letter-spacing: 1px;
    }
    
    .card-subtitle {
      font-size: 14px;
      opacity: 0.9;
      letter-spacing: 0.5px;
    }
    
    .card-photo {
      width: 100%;
      height: auto;  /* âœ… è‡ªåŠ¨é«˜åº¦ */
      max-height: 400px;  /* é™åˆ¶æœ€å¤§é«˜åº¦ï¼Œé¿å…è¿‡é«˜ */
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      border-radius: 8px;
      background: #f5f5f5;
      min-height: 60px;  /* æ— å›¾ç‰‡æ—¶çš„æœ€å°é«˜åº¦ */
    }
    
    .card-photo img {
      width: 100%;
      height: auto;  /* âœ… ä¿æŒåŸå§‹æ¯”ä¾‹ */
      display: block;
      border-radius: 8px;
      object-fit: contain;  /* å®Œæ•´æ˜¾ç¤ºï¼Œä¸è£å‰ª */
    }
    
    .card-photo.no-photo {
      height: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      color: #ccc;
    }
    
    .card-body {
      padding: 40px;
      background: white;
    }
    
    .card-content {
      font-size: 17px;
      line-height: 2;
      color: #333;
      margin-bottom: 30px;
      white-space: pre-wrap;
      word-wrap: break-word;
      letter-spacing: 0.5px;
      text-align: justify;
    }
    
    .card-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 25px;
    }
    
    .card-tag {
      padding: 8px 18px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 20px;
      font-size: 13px;
      letter-spacing: 0.5px;
    }
    
    .card-signature {
      text-align: right;
      color: #999;
      font-size: 14px;
      padding-top: 25px;
      border-top: 2px solid #eee;
      margin-bottom: 25px;
      line-height: 1.8;
      letter-spacing: 0.5px;
    }
    
    .card-footer {
      text-align: center;
      padding: 20px;
      background: #f8f9fa;
      color: #999;
      font-size: 13px;
      letter-spacing: 0.5px;
      line-height: 1.6;
    }
    
    .card-footer-logo {
      font-size: 20px;
      margin-bottom: 5px;
    }
    
    /* æ“ä½œæŒ‰é’® */
    .action-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 15px;
    }
    
    .btn {
      padding: 16px;
      border: none;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      letter-spacing: 0.5px;
    }
    
    .btn-secondary {
      background: #f0f0f0;
      color: #333;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    
    .btn:active {
      transform: scale(0.98);
    }
    
    .btn-next {
      width: 100%;
      padding: 18px;
      border: none;
      border-radius: 12px;
      font-size: 17px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      letter-spacing: 1px;
    }
    
    .btn-next:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }
    
    .btn-next:active {
      transform: scale(0.98);
    }
    
    .back-btn {
      display: inline-block;
      color: white;
      text-decoration: none;
      padding: 12px 30px;
      background: rgba(255,255,255,0.2);
      border-radius: 50px;
      backdrop-filter: blur(10px);
      transition: all 0.3s;
      margin-bottom: 20px;
      letter-spacing: 0.5px;
    }
    
    .back-btn:hover {
      background: rgba(255,255,255,0.3);
      transform: translateX(-5px);
    }
    
    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
      line-height: 1.8;
    }
    
    /* åˆ†äº«å¼¹çª— */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    
    .modal.show {
      display: flex;
    }
    
    .modal-content {
      background: white;
      border-radius: 20px;
      padding: 30px;
      max-width: 400px;
      width: 100%;
      animation: modalAppear 0.3s ease-out;
    }
    
    @keyframes modalAppear {
      from {
        opacity: 0;
        transform: scale(0.9);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }
    
    .modal-header {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 20px;
      text-align: center;
      letter-spacing: 0.5px;
    }
    
    .share-options {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .share-btn {
      padding: 15px;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      background: white;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 15px;
      display: flex;
      align-items: center;
      gap: 12px;
      letter-spacing: 0.5px;
    }
    
    .share-btn:hover {
      border-color: #667eea;
      background: #f8f9ff;
    }
    
    .share-icon {
      font-size: 24px;
    }
    
    .modal-close {
      margin-top: 20px;
      width: 100%;
      padding: 14px;
      background: #f0f0f0;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-size: 15px;
      letter-spacing: 0.5px;
    }
    
    @media (max-width: 600px) {
      body {
        padding: 15px;
      }
      
      .header h1 {
        font-size: 28px;
      }
      
      .fishing-area {
        padding: 30px 20px;
      }
      
      .fishing-icon {
        font-size: 60px;
      }
      
      .card-body {
        padding: 25px 20px 20px;
      }
      
      .card-content {
        font-size: 16px;
        line-height: 1.9;
        margin-bottom: 25px;
      }
      
      .card-photo {
        height: 250px;
      }
      
      .action-buttons {
        grid-template-columns: 1fr;
      }
      
      .card-signature {
        font-size: 13px;
        padding-top: 20px;
        margin-bottom: 20px;
      }
      
      .card-footer {
        padding: 18px 20px;
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="index.html" class="back-btn">â† è¿”å›é¦–é¡µ</a>
    
    <div class="header">
      <h1>ğŸ£ æå–è®°å¿†</h1>
      <p>è½»è½»ä¸€æï¼Œé‡è§ä¸€æ®µæœªçŸ¥çš„æ•…äº‹</p>
    </div>
    
    <div class="fishing-area">
      <div class="fishing-icon">ğŸ£</div>
      <div class="fishing-text">å‡†å¤‡å¥½æå–ä¸€æ®µè®°å¿†äº†å—ï¼Ÿ</div>
      <button class="fishing-btn" id="fishingBtn">ğŸ£ æä¸€å¼ å¡ç‰‡</button>
    </div>
    
    <div class="memory-card" id="memoryCardWrapper">
      <div id="memoryCard">
        <div class="card-header">
          <div class="card-title">è®°å¿†äº¤æ¢è®¡åˆ’</div>
          <div class="card-subtitle">Memory Exchange Project</div>
        </div>
        
        <div class="card-photo" id="cardPhoto">
      
        </div>
        
        <div class="card-body">
          <div class="card-content" id="cardContent"></div>
          <div class="card-tags" id="cardTags"></div>
          <div class="card-signature" id="cardSignature"></div>
          
          <div class="action-buttons">
            <button class="btn btn-secondary" onclick="saveCard()">
              ğŸ’¾ ä¿å­˜å¡ç‰‡
            </button>
            <button class="btn btn-secondary" onclick="openShareModal()">
              ğŸ“¤ åˆ†äº«
            </button>
          </div>
          <button class="btn-next" onclick="fetchMemory()">
            ğŸ£ å†æä¸€å¼ 
          </button>
        </div>
        
        <div class="card-footer">
          <div class="card-footer-logo">ğŸ</div>
          <div>è®©æ—¶å…‰åœ¨è¿™é‡Œäº¤æ±‡</div>
        </div>
      </div>
    </div>
  </div>

  <!-- åˆ†äº«å¼¹çª— -->
  <div class="modal" id="shareModal">
    <div class="modal-content">
      <div class="modal-header">ğŸ“¤ åˆ†äº«</div>
      <div class="share-options">
        <button class="share-btn" onclick="shareToWeChat()">
          <span class="share-icon">ğŸ’¬</span>
          <span>å¤åˆ¶é“¾æ¥ï¼ˆå¾®ä¿¡åˆ†äº«ï¼‰</span>
        </button>
        <button class="share-btn" onclick="shareToQQ()">
          <span class="share-icon">ğŸ§</span>
          <span>åˆ†äº«åˆ° QQ</span>
        </button>
        <button class="share-btn" onclick="shareToWeibo()">
          <span class="share-icon">ğŸ“±</span>
          <span>åˆ†äº«åˆ°å¾®åš</span>
        </button>
        <button class="share-btn" onclick="copyLink()">
          <span class="share-icon">ğŸ”—</span>
          <span>å¤åˆ¶ç½‘ç«™é“¾æ¥</span>
        </button>
      </div>
      <button class="modal-close" onclick="closeShareModal()">å…³é—­</button>
    </div>
  </div>

  <script>
    console.log('ğŸš€ è„šæœ¬å¼€å§‹åŠ è½½...');
    
    // æ£€æŸ¥ SDK
    if (typeof AV === 'undefined') {
      console.error('âŒ LeanCloud SDK æœªåŠ è½½ï¼');
      alert('âŒ LeanCloud SDK æœªåŠ è½½ï¼è¯·åˆ·æ–°é¡µé¢é‡è¯•');
    } else {
      console.log('âœ… LeanCloud SDK å·²åŠ è½½');
    }

    // åˆå§‹åŒ– LeanCloud
    try {
      AV.init({
        appId: "AjDlSqRRtPZxgvP7oKE51Ed3-MdYXbMMI",
        appKey: "AmW2gLklfoggtMLACiWLkYZr",
        serverURL: "https://memory-proxy.zhangjiayi1219.workers.dev/"
      });
      console.log('âœ… LeanCloud åˆå§‹åŒ–æˆåŠŸ');
    } catch (error) {
      console.error('âŒ LeanCloud åˆå§‹åŒ–å¤±è´¥:', error);
    }

    // æå–è®°å¿†å‡½æ•°
    async function fetchMemory() {
      console.log('ğŸ£ å¼€å§‹æå–è®°å¿†...');
      
      const btn = document.getElementById('fishingBtn');
      const memoryCardWrapper = document.getElementById('memoryCardWrapper');
      
      if (!btn) {
        console.error('âŒ æ‰¾ä¸åˆ°æŒ‰é’®å…ƒç´ ï¼');
        return;
      }
      
      btn.disabled = true;
      btn.textContent = 'ğŸ£ æå–ä¸­...';
      memoryCardWrapper.classList.remove('show');
      
      try {
        console.log('ğŸ“Š æŸ¥è¯¢æ•°æ®åº“...');
        const query = new AV.Query('Memory');
        const count = await query.count();
        console.log(`ğŸ“Š æ•°æ®åº“ä¸­æœ‰ ${count} æ¡è®°å¿†`);
        
        if (count === 0) {
          console.log('ğŸ˜¢ æ•°æ®åº“ä¸ºç©º');
          showNoMemory();
          return;
        }
        
        const randomSkip = Math.floor(Math.random() * count);
        console.log(`ğŸ² éšæœºè·³è¿‡ ${randomSkip} æ¡`);
        
        query.skip(randomSkip);
        query.limit(1);
        
        const memories = await query.find();
        console.log('ğŸ“¦ è·å–åˆ°çš„æ•°æ®:', memories);
        
        if (memories.length === 0) {
          console.log('ğŸ˜¢ æ²¡æœ‰è·å–åˆ°è®°å¿†');
          showNoMemory();
          return;
        }
        
        console.log('âœ… æˆåŠŸè·å–è®°å¿†ï¼Œå‡†å¤‡æ˜¾ç¤º');
        displayMemory(memories[0]);
        
      } catch (error) {
        console.error('âŒ æå–å¤±è´¥:', error);
        alert('æå–å¤±è´¥ï¼š' + error.message);
      } finally {
        btn.disabled = false;
        btn.textContent = 'ğŸ£ å†æä¸€å¼ ';
      }
    }

    function showNoMemory() {
      console.log('ğŸ“¢ æ˜¾ç¤º"æš‚æ— è®°å¿†"');
      const cardBody = document.querySelector('.card-body');
      
      cardBody.innerHTML = `
        <div class="loading">
          <p style="font-size: 24px; margin-bottom: 10px;">ğŸ˜¢</p>
          <p>æš‚æ—¶æ²¡æœ‰è®°å¿†äº†</p>
          <p style="font-size: 14px; color: #999; margin-top: 10px;">ç­‰å¾…æ›´å¤šäººæŠ•é€’...</p>
        </div>
      `;
      
      document.getElementById('memoryCardWrapper').classList.add('show');
    }

    function displayMemory(memory) {
      console.log('ğŸ¨ å¼€å§‹æ¸²æŸ“å¡ç‰‡');
      
      const content = memory.get('content');
      const tags = memory.get('tags') || [];
      const photoUrl = memory.get('photo');
      const createdAt = memory.createdAt;
      
      // è·å–ç½²å
      const signatureType = memory.get('signatureType');
      const grade = memory.get('grade');
      const nickname = memory.get('nickname');
      
      let signature = 'â€”â€” ä¸€ä½åŒ¿åçš„TA';
      if (signatureType === 'æ˜¾ç¤ºå¹´çº§' && grade) {
        signature = `â€”â€” ${grade}çš„TA`;
      } else if (signatureType === 'æ˜¾ç¤ºæ˜µç§°' && nickname) {
        signature = `â€”â€” ${nickname}`;
      }
      
      console.log('ğŸ“ è®°å¿†å†…å®¹:', { content, tags, signature, photoUrl });
      
      // æ˜¾ç¤ºç…§ç‰‡
      const photoDiv = document.getElementById('cardPhoto');
      

      if (photoUrl) {
        console.log('ğŸ“¸ ç…§ç‰‡ URL:', photoUrl);
        
        // æ¸…ç©ºå®¹å™¨
        photoDiv.innerHTML = '';
        photoDiv.classList.remove('no-photo');
        
        // åˆ›å»º img å…ƒç´ 
        const img = document.createElement('img');
        img.src = photoUrl;
        img.alt = 'è®°å¿†ç…§ç‰‡';
        img.crossOrigin = 'anonymous';  // âœ… å…³é”®ï¼šå…è®¸è·¨åŸŸ
        
        // åŠ è½½å¤±è´¥æ—¶çš„å¤„ç†
        img.onerror = function() {
          console.error('âŒ å›¾ç‰‡åŠ è½½å¤±è´¥:', photoUrl);
          photoDiv.innerHTML = 'ğŸ“¸<br><small style="font-size:12px;">å›¾ç‰‡åŠ è½½å¤±è´¥</small>';
          photoDiv.classList.add('no-photo');
        };
        
        // åŠ è½½æˆåŠŸ
        img.onload = function() {
          console.log('âœ… å›¾ç‰‡åŠ è½½æˆåŠŸ');
        };
        
        photoDiv.appendChild(img);
        
      } else {
        console.log('ğŸ“¸ æ— ç…§ç‰‡');
        photoDiv.innerHTML = 'ğŸ“¸';
        photoDiv.classList.add('no-photo');
      }
      
      // æ˜¾ç¤ºå†…å®¹
      document.getElementById('cardContent').textContent = content;
      
      // æ˜¾ç¤ºæ ‡ç­¾
      const tagsHTML = tags.map(tag => `<span class="card-tag">#${escapeHtml(tag)}</span>`).join('');
      document.getElementById('cardTags').innerHTML = tagsHTML;
      
      // æ˜¾ç¤ºç½²å
      document.getElementById('cardSignature').innerHTML = `
        ${escapeHtml(signature)}<br>
        <span style="font-size: 12px; color: #ccc;">${formatDate(createdAt)}</span>
      `;
      
      document.getElementById('memoryCardWrapper').classList.add('show');
      console.log('âœ… å¡ç‰‡æ¸²æŸ“å®Œæˆ');
      
      setTimeout(() => {
        document.getElementById('memoryCardWrapper').scrollIntoView({ behavior: 'smooth', block: 'start' });
      }, 100);
    }


    // ä¿å­˜å¡ç‰‡ä¸ºå›¾ç‰‡
    async function saveCard() {
      const btn = event.target;
      const originalText = btn.innerHTML;
      btn.innerHTML = 'â³ ç”Ÿæˆä¸­...';
      btn.disabled = true;
      
      try {
        const cardContent = document.getElementById('memoryCard');
        
        // ä¸´æ—¶éšè—æŒ‰é’®
        const actionButtons = cardContent.querySelector('.action-buttons');
        const btnNext = cardContent.querySelector('.btn-next');
        actionButtons.style.display = 'none';
        btnNext.style.display = 'none';
        
        // ä½¿ç”¨ html2canvas ç”Ÿæˆå›¾ç‰‡
        const canvas = await html2canvas(cardContent, {
          backgroundColor: null,
          scale: 2,
          logging: false,
          useCORS: true,
          allowTaint: true
        });
        
        // æ¢å¤æŒ‰é’®
        actionButtons.style.display = '';
        btnNext.style.display = '';
        
        // è½¬æ¢ä¸ºå›¾ç‰‡å¹¶ä¸‹è½½
        canvas.toBlob(function(blob) {
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `è®°å¿†å¡ç‰‡_${Date.now()}.png`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
          
          btn.innerHTML = 'âœ… å·²ä¿å­˜';
          setTimeout(() => {
            btn.innerHTML = originalText;
            btn.disabled = false;
          }, 2000);
        });
        
      } catch (error) {
        console.error('ä¿å­˜å¤±è´¥:', error);
        alert('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•');
        btn.innerHTML = originalText;
        btn.disabled = false;
      }
    }

    // æ‰“å¼€åˆ†äº«å¼¹çª—
    function openShareModal() {
      document.getElementById('shareModal').classList.add('show');
    }

    // å…³é—­åˆ†äº«å¼¹çª—
    function closeShareModal() {
      document.getElementById('shareModal').classList.remove('show');
    }

    // åˆ†äº«åˆ°å¾®ä¿¡ï¼ˆå¤åˆ¶é“¾æ¥ï¼‰
    function shareToWeChat() {
      copyLink();
      alert('âœ… é“¾æ¥å·²å¤åˆ¶ï¼\nè¯·åœ¨å¾®ä¿¡ä¸­ç²˜è´´åˆ†äº«ç»™å¥½å‹');
    }

    // åˆ†äº«åˆ° QQ
    function shareToQQ() {
      const url = encodeURIComponent(window.location.origin + '/index.html');
      const title = encodeURIComponent('è®°å¿†äº¤æ¢è®¡åˆ’ - æå–ä¸€æ®µæœªçŸ¥çš„æ•…äº‹');
      window.open(`https://connect.qq.com/widget/shareqq/index.html?url=${url}&title=${title}`);
    }

    // åˆ†äº«åˆ°å¾®åš
    function shareToWeibo() {
      const url = encodeURIComponent(window.location.origin + '/index.html');
      const title = encodeURIComponent('è®°å¿†äº¤æ¢è®¡åˆ’ - æå–ä¸€æ®µæœªçŸ¥çš„æ•…äº‹ ğŸ£');
      window.open(`https://service.weibo.com/share/share.php?url=${url}&title=${title}`);
    }

    // å¤åˆ¶é“¾æ¥
    function copyLink() {
      const url = window.location.origin + '/index.html';
      
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(url).then(() => {
          alert('âœ… é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼\n' + url);
        }).catch(() => {
          fallbackCopy(url);
        });
      } else {
        fallbackCopy(url);
      }
    }

    // å¤‡ç”¨å¤åˆ¶æ–¹æ³•
    function fallbackCopy(text) {
      const textarea = document.createElement('textarea');
      textarea.value = text;
      textarea.style.position = 'fixed';
      textarea.style.opacity = '0';
      document.body.appendChild(textarea);
      textarea.select();
      
      try {
        document.execCommand('copy');
        alert('âœ… é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼\n' + text);
      } catch (err) {
        alert('âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ï¼š\n' + text);
      }
      
      document.body.removeChild(textarea);
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function formatDate(date) {
      const now = new Date();
      const diff = now - date;
      const seconds = Math.floor(diff / 1000);
      const minutes = Math.floor(seconds / 60);
      const hours = Math.floor(minutes / 60);
      const days = Math.floor(hours / 24);
      
      if (days > 0) return `${days}å¤©å‰`;
      if (hours > 0) return `${hours}å°æ—¶å‰`;
      if (minutes > 0) return `${minutes}åˆ†é’Ÿå‰`;
      return 'åˆšåˆš';
    }

    // ç»‘å®šæŒ‰é’®ç‚¹å‡»äº‹ä»¶
    document.addEventListener('DOMContentLoaded', function() {
      console.log('ğŸ“„ DOM åŠ è½½å®Œæˆ');
      const btn = document.getElementById('fishingBtn');
      if (btn) {
        console.log('âœ… æ‰¾åˆ°æŒ‰é’®ï¼Œç»‘å®šç‚¹å‡»äº‹ä»¶');
        btn.addEventListener('click', function() {
          console.log('ğŸ–±ï¸ æŒ‰é’®è¢«ç‚¹å‡»ï¼');
          fetchMemory();
        });
      } else {
        console.error('âŒ æ‰¾ä¸åˆ°æŒ‰é’®å…ƒç´ ï¼');
      }
      
      // ç‚¹å‡»å¼¹çª—èƒŒæ™¯å…³é—­
      document.getElementById('shareModal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeShareModal();
        }
      });
    });

    console.log('âœ… è„šæœ¬åŠ è½½å®Œæˆ');
  </script>
</body>
</html>
